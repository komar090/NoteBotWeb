<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Note Bot Tasks</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Ionicons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>
    <!-- API Status Bar (Self-Check) -->
    <div id="apiStatus" style="padding: 5px 15px; font-size: 10px; text-align: right; opacity: 0.5;">
        API: <span id="apiStatusText">Checking...</span>
    </div>

    <!-- View 1: My Tasks -->
    <div id="view-tasks" class="view active">
        <h1 style="display: flex; justify-content: space-between; align-items: center;">
            –ú–æ–∏ –∑–∞–¥–∞—á–∏
            <span id="taskCount" style="font-size: 16px; opacity: 0.7; font-weight: normal;">0</span>
        </h1>

        <div id="taskList" class="glass-card" style="padding: 0;">
            <div class="loader"></div>
        </div>

        <div class="glass-card">
            <h2>‚ú® –ü—Ä–æ–≥—Ä–µ—Å—Å</h2>
            <div
                style="height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin-top: 10px;">
                <div id="progressBar"
                    style="width: 0%; height: 100%; background: linear-gradient(90deg, #4caf50, #8bc34a); transition: width 0.5s;">
                </div>
            </div>
        </div>
    </div>

    <!-- View 2: Create Task -->
    <div id="view-create" class="view">
        <h1>üöÄ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h1>

        <div class="glass-card">
            <div class="form-group">
                <label>–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?</label>
                <div class="input-wrapper" style="position: relative;">
                    <textarea id="taskInput" rows="3" placeholder="–ö—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ..."></textarea>
                </div>
            </div>

            <div class="form-group">
                <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <select id="categorySelect">
                    <option value="–†–∞–±–æ—Ç–∞">üíº –†–∞–±–æ—Ç–∞</option>
                    <option value="–õ–∏—á–Ω–æ–µ">üè† –õ–∏—á–Ω–æ–µ</option>
                    <option value="–ü–æ–∫—É–ø–∫–∏">üõí –ü–æ–∫—É–ø–∫–∏</option>
                    <option value="–£—á–µ–±–∞">üìö –£—á–µ–±–∞</option>
                    <option value="–ò–¥–µ–∏">üí° –ò–¥–µ–∏</option>
                </select>
            </div>

            <div class="row">
                <div class="form-group half">
                    <label>–î–∞—Ç–∞</label>
                    <input type="date" id="dateInput">
                </div>
                <div class="form-group half">
                    <label>–í—Ä–µ–º—è</label>
                    <input type="time" id="timeInput">
                </div>
            </div>
        </div>

        <p class="hint">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É —Å–æ–∑–¥–∞–Ω–∏—è</p>

        <!-- DEBUG LOG (Collapsible or hidden by default) -->
        <div style="margin-top:20px; border-top:1px solid #333; padding-top:10px;">
            <p style="font-size:10px; color:#666; cursor:pointer;"
                onclick="document.getElementById('debugLog').style.display = document.getElementById('debugLog').style.display === 'none' ? 'block' : 'none'">
                DEBUG INFO (click to toggle)</p>
            <pre id="debugLog"
                style="background:#000; color:#0f0; padding:10px; font-size:10px; overflow-x:scroll; border-radius:8px; display:none;"></pre>
        </div>
    </div>

    <!-- View 3: Settings -->
    <div id="view-settings" class="view">
        <h1>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
        <div class="glass-card">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <div
                    style="width: 50px; height: 50px; background: var(--tg-theme-button-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                    üë§
                </div>
                <div>
                    <h3 id="profileName" style="margin:0;">User</h3>
                    <span id="profileStatus" class="badge">Loading...</span>
                </div>
            </div>
        </div>

        <div class="glass-card">
            <h3>üïí –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</h3>
            <div class="form-group" style="margin-top:10px;">
                <select id="tzSelect" onchange="updateTimezone()">
                    <option value="UTC">UTC (0)</option>
                    <option value="Europe/Moscow">–ú–æ—Å–∫–≤–∞ (+3)</option>
                    <option value="Asia/Yekaterinburg">–ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (+5)</option>
                    <option value="Asia/Novosibirsk">–ù–æ–≤–æ—Å–∏–±–∏—Ä—Å–∫ (+7)</option>
                    <option value="Asia/Vladivostok">–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫ (+10)</option>
                </select>
            </div>
        </div>

        <div class="glass-card">
            <h3>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div id="categoryList" style="margin-top:10px;">
                <!-- Categories will be listed here -->
            </div>
            <div class="form-group" style="margin-top:15px; display:flex; gap:10px;">
                <input type="text" id="newCatInput" placeholder="–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è" style="flex:1;">
                <button class="btn" onclick="addNewCategory()"
                    style="padding: 10px; background:var(--tg-theme-button-color);">‚ûï</button>
            </div>
        </div>

        <div class="glass-card">
            <h3 style="margin-bottom: 5px;">–û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
            <p style="font-size: 12px; opacity: 0.5;">–í–µ—Ä—Å–∏—è 4.0 (Mini App Focus)</p>
        </div>
    </div>

    <!-- View 4: Admin (Hidden) -->
    <div id="view-admin" class="view">
        <h1>‚ö° Admin Panel</h1>
        <div id="adminStats">
            Loading...
        </div>
    </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="#" class="nav-item active" onclick="switchView('tasks')">
            <ion-icon name="list-outline"></ion-icon>
        </a>
        <a href="#" class="nav-item" onclick="switchView('create')">
            <ion-icon name="add-circle-outline"
                style="font-size: 40px; color: var(--tg-theme-button-color);"></ion-icon>
        </a>
        <a href="#" class="nav-item" onclick="switchView('settings')">
            <ion-icon name="settings-outline"></ion-icon>
        </a>
    </nav>

    <script src="script.js?v=13"></script>
</body>

</html>